# CI test case for Gateway API support
name: backstage
namespace: devportal
backstageDiscovery:
  kubernetesId: backstage
userID: 1000
groupID: 1000
image:
  name: backstage
  repository: giantswarm/backstage
port: 7007
registry:
  domain: gsoci.azurecr.io
authSessionSecret: fooBar
circleci:
  apiToken: dummyToken
dexAuthCredentials:
  example-1:
    clientID: exampleOneDummyClientID
    clientSecret: exampleOneDummyClientSecret
githubAuthCredentials:
  clientID: dummyClientID
  clientSecret: dummyClientSecret
githubAppCredentials:
  appId: 42
  webhookUrl: 'dummyWehbookUrl'
  webhookSecret: 'dummyWebhookSecret'
  clientId: 'dummyClientID'
  clientSecret: 'dummyClientSecret'
  privateKey: |
    dummy
    private
    key
grafana:
  apiToken: dummyToken
sentry:
  app:
    dsn: summySentryDSN
  backend:
    dsn: summySentryDSN
backstage:
  command: ['node', 'packages/backend']
  args: []
  extraAppConfig: []
  extraEnvVars: []
resources:
  verticalPodAutoscaler:
    enabled: true
  requests:
    cpu: 30m
    memory: 300M
  limits:
    cpu: 500m
    memory: 600M
database:
  engine: sqlite

# Disable traditional Ingress
ingress:
  enabled: false

# Enable Gateway API HTTPRoute
route:
  enabled: true
  kind: HTTPRoute
  hostnames:
    - backstage.example.com
  parentRefs:
    - name: giantswarm-default
      namespace: envoy-gateway-system
  matches:
    - path:
        type: PathPrefix
        value: /
  securityPolicy:
    enabled: true
    oidc:
      provider:
        issuer: https://dex.example.com
        authorizationEndpoint: https://dex.example.com/auth
        tokenEndpoint: https://dex.example.com/token
        clientID: backstage
        clientSecret:
          name: backstage-oidc-secret
      redirectURL: https://backstage.example.com/oauth2/callback
